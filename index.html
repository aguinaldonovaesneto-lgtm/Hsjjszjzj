
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Doom Day Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; touch-action: none; font-family: 'Arial Black', sans-serif; }
        #ui { position: absolute; width: 100%; height: 100%; pointer-events: none; }
        
        /* HUD */
        #hud { position: absolute; bottom: 0; width: 100%; height: 60px; background: rgba(50, 50, 50, 0.8); border-top: 4px solid #fff; display: flex; justify-content: space-around; align-items: center; color: #fff; pointer-events: none; }
        .stat-box { text-align: center; border: 2px solid #fff; padding: 2px 15px; background: #000; }
        .label { font-size: 10px; color: #0f0; display: block; }
        .value { font-size: 20px; color: #fff; }

        /* Controles */
        #joy-base { position: absolute; bottom: 80px; left: 40px; width: 100px; height: 100px; background: rgba(0,0,0,0.2); border: 2px solid #fff; border-radius: 50%; pointer-events: auto; }
        #joy-knob { position: absolute; top: 50%; left: 50%; width: 40px; height: 40px; background: #fff; border-radius: 50%; transform: translate(-50%, -50%); }
        #fire-btn { position: absolute; bottom: 90px; right: 40px; width: 90px; height: 90px; background: #ff0000; border: 4px solid #fff; border-radius: 50%; pointer-events: auto; display: flex; align-items: center; justify-content: center; color: #fff; font-weight: bold; }

        #crosshair { position: absolute; top: 50%; left: 50%; width: 20px; height: 20px; border: 2px solid #f00; border-radius: 50%; transform: translate(-50%, -50%); }
        #damage { position: absolute; width: 100%; height: 100%; background: rgba(255,0,0,0.5); display: none; pointer-events: none; }
    </style>
</head>
<body>

    <div id="damage"></div>
    <div id="crosshair"></div>
    
    <div id="ui">
        <div id="joy-base"><div id="joy-knob"></div></div>
        <div id="fire-btn">FOGO</div>
        <div id="hud">
            <div class="stat-box"><span class="label">VIDA</span><span class="value" id="hp-txt">100</span></div>
            <div class="stat-box"><span class="label">KILLS</span><span class="value" id="score-txt">0</span></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Configuração da Cena (Céu Azul Claro)
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB); 
        scene.fog = new THREE.Fog(0x87CEEB, 10, 50);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // ILUMINAÇÃO DE DIA
        const sun = new THREE.DirectionalLight(0xffffff, 1.2);
        sun.position.set(5, 10, 7.5);
        scene.add(sun);
        scene.add(new THREE.AmbientLight(0xffffff, 0.6));

        // Materiais
        const wallMat = new THREE.MeshStandardMaterial({ color: 0x888888 });
        const groundMat = new THREE.MeshStandardMaterial({ color: 0x33aa33 }); // Grama verde

        // Chão e Mapa
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(100,100), groundMat);
        floor.rotation.x = -Math.PI/2;
        scene.add(floor);

        const walls = [];
        function box(x, z, w, d) {
            const b = new THREE.Mesh(new THREE.BoxGeometry(w, 4, d), wallMat);
            b.position.set(x, 2, z);
            scene.add(b);
            walls.push(b);
        }
        // Criando alguns obstáculos
        box(0, -10, 15, 1); box(7, -5, 1, 10); box(-7, -5, 1, 10); box(0, 10, 20, 1);

        // Arma 3D
        const gun = new THREE.Group();
        const body = new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.4, 1.2), new THREE.MeshStandardMaterial({color:0x222222}));
        const barrel = new THREE.Mesh(new THREE.CylinderGeometry(0.08, 0.08, 0.8), new THREE.MeshStandardMaterial({color:0x000000}));
        barrel.rotation.x = Math.PI/2; barrel.position.z = -0.6;
        gun.add(body, barrel);
        gun.position.set(0.4, -0.4, -0.8);
        camera.add(gun);

        // Inimigos (Agora pretos para contrastar com o dia)
        const enemies = [];
        function spawn() {
            const e = new THREE.Group();
            const b = new THREE.Mesh(new THREE.BoxGeometry(1, 2, 1), new THREE.MeshStandardMaterial({color:0x111111}));
            const h = new THREE.Mesh(new THREE.BoxGeometry(0.6, 0.6, 0.6), new THREE.MeshStandardMaterial({color:0xff0000}));
            h.position.y = 1.2;
            e.add(b, h);
            e.position.set(Math.random()*40-20, 1, Math.random()*-40-10);
            scene.add(e);
            enemies.push(e);
        }
        for(let i=0; i<8; i++) spawn();

        // CONTROLES
        let moveDir = { x: 0, z: 0 };
        let moveId = null, lookId = null;
        let lastX, lastY;
        let hp = 100, score = 0;

        window.addEventListener('touchstart', e => {
            for(let t of e.changedTouches) {
                if(t.clientX < window.innerWidth/2 && moveId === null) moveId = t.identifier;
                else if(lookId === null) {
                    lookId = t.identifier;
                    lastX = t.clientX; lastY = t.clientY;
                }
            }
        });

        window.addEventListener('touchmove', e => {
            for(let t of e.changedTouches) {
                if(t.identifier === moveId) {
                    const rect = document.getElementById('joy-base').getBoundingClientRect();
                    const dx = t.clientX - (rect.left + 50);
                    const dy = t.clientY - (rect.top + 50);
                    const dist = Math.min(Math.sqrt(dx*dx + dy*dy), 40);
                    const ang = Math.atan2(dy, dx);
                    document.getElementById('joy-knob').style.transform = `translate(calc(-50% + ${Math.cos(ang)*dist}px), calc(-50% + ${Math.sin(ang)*dist}px))`;
                    moveDir.x = Math.cos(ang) * (dist/40);
                    moveDir.z = Math.sin(ang) * (dist/40);
                }
                if(t.identifier === lookId) {
                    camera.rotation.y -= (t.clientX - lastX) * 0.008;
                    camera.rotation.x -= (t.clientY - lastY) * 0.008;
                    camera.rotation.x = Math.max(-1.2, Math.min(1.2, camera.rotation.x));
                    lastX = t.clientX; lastY = t.clientY;
                }
            }
        });

        window.addEventListener('touchend', e => {
            for(let t of e.changedTouches) {
                if(t.identifier === moveId) {
                    moveId = null; moveDir = {x:0, z:0};
                    document.getElementById('joy-knob').style.transform = 'translate(-50%, -50%)';
                }
                if(t.identifier === lookId) lookId = null;
            }
        });

        // Tiros
        const bullets = [];
        document.getElementById('fire-btn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            const b = new THREE.Mesh(new THREE.SphereGeometry(0.1), new THREE.MeshBasicMaterial({color:0xff6600}));
            b.position.copy(camera.position);
            const dir = new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion);
            b.userData.v = dir.multiplyScalar(0.8);
            bullets.push(b); scene.add(b);
            gun.position.z = -0.6;
            setTimeout(() => gun.position.z = -0.8, 50);
        });

        function update() {
            requestAnimationFrame(update);
            
            const old = camera.position.clone();
            camera.translateZ(moveDir.z * 0.15);
            camera.translateX(moveDir.x * 0.15);
            camera.position.y = 1.6;

            // Colisões básicas
            walls.forEach(w => {
                if(new THREE.Box3().setFromObject(w).distanceToPoint(camera.position) < 0.5) camera.position.copy(old);
            });

            // Balas
            bullets.forEach((b, i) => {
                b.position.add(b.userData.v);
                enemies.forEach(en => {
                    if(b.position.distanceTo(en.position) < 1.3) {
                        en.position.set(Math.random()*40-20, 1, Math.random()*-40-10);
                        score++; document.getElementById('score-txt').innerText = score;
                    }
                });
                if(b.position.distanceTo(camera.position) > 50) { scene.remove(b); bullets.splice(i, 1); }
            });

            // IA Inimigos
            enemies.forEach(en => {
                const d = new THREE.Vector3().subVectors(camera.position, en.position).normalize();
                en.position.x += d.x * 0.06; en.position.z += d.z * 0.06;
                en.lookAt(camera.position.x, 1, camera.position.z);
                if(en.position.distanceTo(camera.position) < 1.4) {
                    hp -= 0.3; document.getElementById('hp-txt').innerText = Math.floor(hp);
                    document.getElementById('damage').style.display = 'block';
                    setTimeout(() => document.getElementById('damage').style.display = 'none', 30);
                }
            });

            if(hp <= 0) { alert("Você caiu em combate!"); location.reload(); }
            renderer.render(scene, camera);
        }
        update();

        window.onresize = () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        };
    </script>
</body>
</html>
